{{ if (eq .chezmoi.os "linux") -}}
#!/bin/bash
{{ if (eq .chezmoi.osRelease.id "void")}}
    {{ if and (not (eq (env "XDG_SESSION_DESKTOP") "sway"))
    (not (env "XDG_RUNTIME_DIR")) }}
# Setup pam_rundir
sudo ln -s /etc/sv/seatd /var/service
sudo usermod -a -G _seatd {{ (env "USER") }}
# NOTE: maybe I should not edit this file automatically
echo -ne '-session optional pam_rundir.so\n' | sudo tee -a /etc/pam.d/system-login

# Set up dbus
sudo ln -s /etc/sv/dbus /var/service

# Set up iwd
sudo ln -s /etc/sv/iwd /var/service
sudo ln -s /etc/sv/ead /var/service

# Set up ssh
sudo ln -s /etc/sv/sshd /var/service

{{ if .is_laptop }}
# Set up tlp
sudo ln -s /etc/sv/tlp /var/service
{{ end }}
    {{ end }}
{{ end }}
{{ if not (contains "fish" (env "SHELL")) }}
sudo -u {{ (env "USER") }} chsh -s "{{ or (lookPath "fish") (lookPath "bash") }}";
{{- end }}
{{ if and (lookPath "gpg") (lookPath "rbw") (not (stat (list (env "HOME") "/.gnupg/pubring.kbx" | join ""))) -}}
rbw get {{ quote (cat .email "GPG private key" ) }} | gpg --import
{{- end }}
{{- end }}
